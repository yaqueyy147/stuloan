<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stuloan.web.mybatis.domain.inte.RepaydetailMapper">
  <resultMap id="BaseResultMap" type="com.stuloan.web.mybatis.domain.Repaydetail">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <idArg column="id" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="loanid" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="stagenum" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="repaymoney" javaType="java.lang.Double" jdbcType="DECIMAL" />
      <arg column="repaydateplan" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="repaydatereal" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="isrepay" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="issendmsg" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="state" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="isoverdue" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="remark" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="orderno" javaType="java.lang.String" jdbcType="VARCHAR" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, loanid, stagenum, repaymoney, repaydateplan, repaydatereal, isrepay, issendmsg, state, isoverdue,
    remark, orderno
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from repaydetail
    where id = #{id,jdbcType=VARCHAR}
  </select>

  <select id="selectByParams" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from repaydetail
    where 1=1
    <if test="id != null and id != ''">
      and id = #{id,jdbcType=VARCHAR}
    </if>
    <if test="loanid != null and loanid != ''">
      and loanid = #{loanid,jdbcType=VARCHAR}
    </if>
    <if test="state != null and state != ''">
      and state = #{state,jdbcType=CHAR}
    </if>
    <if test="orderno != null and orderno != ''">
      and orderno = #{orderno,jdbcType=VARCHAR}
    </if>
    <if test="isoverdue != null and isoverdue != ''">
      and isoverdue = #{isoverdue,jdbcType=VARCHAR}
    </if>
    <if test="orderby != null and orderby != ''">
      order by ${orderby}
    </if>
    <if test="beginRow != null and beginRow != ''">
      limit ${beginRow},${pageSize}
    </if>
  </select>

  <select id="selectByParams01" parameterType="java.lang.String" resultType="java.util.Map">
    select
    a.*
    ,b.loanpurpose
    from repaydetail a
    left join loan b on b.id=a.loanid
    where 1=1 and a.state='1'
    <if test="state != null and state != ''">
      and a.state = #{state,jdbcType=CHAR}
    </if>
    <if test="userid != null and userid != ''">
      and b.userid = #{userid,jdbcType=CHAR}
    </if>
    <if test="orderby != null and orderby != ''">
      order by ${orderby}
    </if>
    <if test="beginRow != null and beginRow != ''">
      limit ${beginRow},${pageSize}
    </if>
  </select>

  <select id="selectCountByParams" parameterType="java.util.Map" resultType="java.lang.Integer">
    select
    count(id) as total
    from repaydetail
    where 1=1 and state='1'
    <if test="id != null and id != ''">
      and id = #{id,jdbcType=VARCHAR}
    </if>

    <if test="loanid != null and loanid != ''">
      and loanid = #{loanid,jdbcType=VARCHAR}
    </if>

  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from repaydetail
    where id = #{id,jdbcType=VARCHAR}
  </delete>

  <delete id="deleteByLoanid" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from repaydetail
    where loanid = #{loanid,jdbcType=VARCHAR}
  </delete>

  <insert id="insert" parameterType="com.stuloan.web.mybatis.domain.Repaydetail">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into repaydetail (id, loanid, stagenum, 
      repaymoney, repaydateplan, repaydatereal, 
      isrepay, issendmsg, state, isoverdue, remark, orderno
      )
    values (#{id,jdbcType=VARCHAR}, #{loanid,jdbcType=VARCHAR}, #{stagenum,jdbcType=INTEGER}, 
      #{repaymoney,jdbcType=DECIMAL}, #{repaydateplan,jdbcType=TIMESTAMP}, #{repaydatereal,jdbcType=TIMESTAMP},
      #{isrepay,jdbcType=CHAR}, #{issendmsg,jdbcType=CHAR}, #{state,jdbcType=CHAR}, #{isoverdue,jdbcType=CHAR}
      , #{remark,jdbcType=VARCHAR}
      , #{orderno,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.stuloan.web.mybatis.domain.Repaydetail">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into repaydetail
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="loanid != null">
        loanid,
      </if>
      <if test="stagenum != null">
        stagenum,
      </if>
      <if test="repaymoney != null">
        repaymoney,
      </if>
      <if test="repaydateplan != null">
        repaydateplan,
      </if>
      <if test="repaydatereal != null">
        repaydatereal,
      </if>
      <if test="isrepay != null">
        isrepay,
      </if>
      <if test="issendmsg != null">
        issendmsg,
      </if>
      <if test="state != null">
        state,
      </if>
      <if test="isoverdue != null">
        isoverdue,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="orderno != null">
        orderno
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="loanid != null">
        #{loanid,jdbcType=VARCHAR},
      </if>
      <if test="stagenum != null">
        #{stagenum,jdbcType=INTEGER},
      </if>
      <if test="repaymoney != null">
        #{repaymoney,jdbcType=DECIMAL},
      </if>
      <if test="repaydateplan != null">
        #{repaydateplan,jdbcType=TIMESTAMP},
      </if>
      <if test="repaydatereal != null">
        #{repaydatereal,jdbcType=TIMESTAMP},
      </if>
      <if test="isrepay != null">
        #{isrepay,jdbcType=CHAR},
      </if>
      <if test="issendmsg != null">
        #{issendmsg,jdbcType=CHAR},
      </if>
      <if test="state != null">
        #{state,jdbcType=CHAR},
      </if>
      <if test="isoverdue != null">
        #{isoverdue,jdbcType=CHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="orderno != null">
        #{orderno,jdbcType=VARCHAR}
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.stuloan.web.mybatis.domain.Repaydetail">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update repaydetail
    <set>
      <if test="stagenum != null">
        stagenum = #{stagenum,jdbcType=INTEGER},
      </if>
      <if test="repaymoney != null">
        repaymoney = #{repaymoney,jdbcType=DECIMAL},
      </if>
      <if test="repaydateplan != null">
        repaydateplan = #{repaydateplan,jdbcType=TIMESTAMP},
      </if>
      <if test="repaydatereal != null">
        repaydatereal = #{repaydatereal,jdbcType=TIMESTAMP},
      </if>
      <if test="isrepay != null">
        isrepay = #{isrepay,jdbcType=CHAR},
      </if>
      <if test="issendmsg != null">
        issendmsg = #{issendmsg,jdbcType=CHAR},
      </if>
      <if test="state != null">
        state = #{state,jdbcType=CHAR},
      </if>
      <if test="isoverdue != null">
        isoverdue = #{isoverdue,jdbcType=CHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="orderno != null">
        orderno = #{orderno,jdbcType=VARCHAR}
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>

  <update id="updatestateByLoanIdSelective" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update repaydetail
    <set>
      <if test="state != null">
        state = #{state,jdbcType=CHAR},
      </if>
    </set>
    where loanid = #{loanid,jdbcType=VARCHAR}
  </update>

  <update id="updateByPrimaryKey" parameterType="com.stuloan.web.mybatis.domain.Repaydetail">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update repaydetail
    set loanid = #{loanid,jdbcType=VARCHAR},
      stagenum = #{stagenum,jdbcType=INTEGER},
      repaymoney = #{repaymoney,jdbcType=DECIMAL},
      repaydateplan = #{repaydateplan,jdbcType=TIMESTAMP},
      repaydatereal = #{repaydatereal,jdbcType=TIMESTAMP},
      isrepay = #{isrepay,jdbcType=CHAR},
      issendmsg = #{issendmsg,jdbcType=CHAR},
      state = #{issendmsg,jdbcType=CHAR},
    isoverdue = #{isoverdue,jdbcType=CHAR},
      remark = #{remark,jdbcType=VARCHAR},
    orderno = #{orderno,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>

  <update id="updatesmsstate" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update repaydetail
    set
    issendmsg = '1'
    where id in (${ids})
  </update>

  <update id="updatebyorderno"  parameterType="com.stuloan.web.mybatis.domain.Repaydetail">
    update repaydetail set isrepay=#{isrepay}
    ,orderno=#{ordernonew}
    <if test="repaydatereal != null and repaydatereal != ''">
      , repaydatereal=#{repaydatereal}
    </if>
    where orderno=#{ordernoold}
  </update>

  <select id="queryoverdue" parameterType="java.util.Date" resultMap="BaseResultMap">
    select * from repaydetail
    where
    repaydateplan &lt; #{searchdate}
  </select>

  <update id="updateoverdue" parameterType="java.util.Date">
    update repaydetail set isoverdue='1'
    where repaydateplan &lt; #{searchdate}
  </update>

  <select id="selectnotrepayByParams" parameterType="java.lang.String" resultType="java.util.Map">
    select
    a.*
    ,b.loanpurpose,s.loginname,s1.stuname
    from repaydetail a
    left join loan b on b.id=a.loanid
    left join sysuser s on s.id=b.userid
    left join studentinfo s1 on s1.userid=b.userid
    where a.state='1' <!--and (a.isrepay &lt;&gt; '1' or a.isrepay is null or a.isrepay='')-->
    <if test="begindate != null and begindate != ''">
      and DATE_FORMAT(a.repaydateplan,'%Y-%m-%d') &gt;= #{begindate}
    </if>
    <if test="enddate != null and enddate != ''">
      and DATE_FORMAT(a.repaydateplan,'%Y-%m-%d') &lt; #{enddate}
    </if>
    <if test="isrepay == 1">
      and a.isrepay=#{isrepay}
    </if>
    <if test="isrepay != 1 and isrepay != '' and isrepay != null">
      and (a.isrepay &lt;&gt; '1' or a.isrepay is null or a.isrepay='')
    </if>
    <if test="loginname != '' and loginname != null">
      and s.loginname like #{loginname}
    </if>
    <if test="stuname != '' and stuname != null">
      and s1.stuname like #{stuname}
    </if>
    <if test="orderby != null and orderby != ''">
      order by ${orderby}
    </if>
    <if test="beginRow != null and beginRow != ''">
      limit ${beginRow},${pageSize}
    </if>
  </select>

  <select id="selectnotrepayCountByParams" parameterType="java.util.Map" resultType="java.lang.Integer">
    select
    count(id) as total
    from repaydetail
    where state='1' <!--and (isrepay &lt;&gt; '1' or isrepay is null or isrepay='')-->
    <if test="id != null and id != ''">
      and id = #{id,jdbcType=VARCHAR}
    </if>
    <if test="begindate != null and begindate != ''">
      and DATE_FORMAT(repaydateplan,'%Y-%m-%d') &gt;= #{begindate}
    </if>
    <if test="enddate != null and enddate != ''">
      and DATE_FORMAT(repaydateplan,'%Y-%m-%d') &lt; #{enddate}
    </if>
    <if test="isrepay != null and isrepay != ''">
      and isrepay=#{isrepay}
    </if>

  </select>

</mapper>